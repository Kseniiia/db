ALTER SESSION SET nls_date_format='DD-MM-YYYY';

-- DATA TABLE --

INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Планирование','01-01-2019','01-03-2019','PLA-001','01-01-2019','15-01-2019','Проектирование планирования','Выполнена','Волчик','Владислав','Project Manager','Management','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Планирование','01-02-2019','01-03-2019','PLA-002','15-01-2019','01-02-2019','Разработка планирования','Выполнена','Илья','Шапиро','Scrum Master','Management','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Планирование','01-02-2019','01-03-2019','PLA-003','01-02-2019','01-03-2019','Реализация','Выполнена','Гутько','Антон','Architect','Development','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Дизайн','01-02-2019','01-04-2019','DIS-001','01-02-2019','15-02-2019','Проектирование дизайна','Проектирование','Игнат','Фомин','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Дизайн','01-02-2019','01-04-2019','DIS-002','15-02-2019','15-03-2019','Разработка дизайна','Разработка','Анатолий','Агейчик','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Дизайн','01-02-2019','01-04-2019','DIS-003','15-03-2019','01-04-2019','Реализация решения','Реализация','Игнат','Фомин','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-001','01-03-2019','01-04-2019','Задача 1','Отменена','Дмитрий','Куделич','DEV Team Lead','Development','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-001','01-04-2019','01-05-2019','Задача 2','Выполнена','Игнат','Фомин','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-002','01-05-2019','01-06-2019','Задача 3','Выполнена','Анатолий','Агейчик','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-003','01-06-2019','01-07-2019','Задача 4','Выполнена','Игнат','Фомин','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-004','01-07-2019','01-08-2019','Задача 5','Выполняется','Анатолий','Агейчик','Developer','Development','Дмитрий','Куделич');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-005','01-08-2019','01-09-2019','Задача 6','Выполняется','Денис','Мартиневский','DEV Team Lead','Development','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-006','01-09-2019','01-10-2019','Задача 7','Выполняется','Алексей','Тухолко','Developer','Development','Денис','Мартиневский');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-007','01-10-2019','01-11-2019','Задача 8','Готова к тестированию','Роман','Жилко','Developer','Development','Денис','Мартиневский');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-008','01-11-2019','01-12-2019','Задача 9','Заморожена','Алексей','Тухолко','Developer','Development','Денис','Мартиневский');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Разработка','01-03-2019','01-05-2020','DEV-009','01-12-2019','01-05-2020','Задача 10','Готова к выполнению','Роман','Жилко','Developer','Development','Денис','Мартиневский');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Тестирование','01-03-2019','01-05-2020','TST-001','01-03-2019','20-03-2019','Тестирование задачи 1','Тестируется','Константин','Збойчик','QA Team Lead','Testing','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Тестирование','01-03-2019','01-05-2020','TST-002','20-03-2019','20-04-2019','Тестирование задачи 2','Выполняется','Фаррухшох','Бобоев','Tester','Testing','Константин','Збойчик');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Тестирование','01-03-2019','01-05-2020','TST-003','20-04-2019','01-05-2020','Тестирование задачи 3','Выполнена','Фаррухшох','Бобоев','Tester','Testing','Константин','Збойчик');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Поддержка','01-08-2019','01-01-2023','SUP-001','01-08-2019','01-09-2019','Проектирование подддержки','Проектирование','Гапанович','Евгений','SUP Team Lead','Support Department','','');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Поддержка','01-08-2019','01-01-2023','SUP-002','01-09-2019','01-01-2023','Поддержка','Готова к выполнению','Марченко','Иван','Support Engineer','Support Department','Гапанович','Евгений');
INSERT INTO DATA_TABLE(Project_Name,Project_Description,Project_Start_Date,Project_End_Date,Stage_Name,Stage_Start_Date,Stage_End_Date,Stage_Tasks_Code,Stage_Tasks_Start_Date,Stage_Tasks_End_Date,Stage_Tasks_Name,Stage_Tasks_Status,Assigned_Person_Name,Assigned_Person_Last_Name,Assigned_Person_Position,Assigned_Person_Department,Team_Lead_Name,Team_Lead_Last_Name) VALUES('Global Ticket','Продажа билетов по всему миру','01-01-2019','07-04-2021','Поддержка','01-08-2019','01-01-2023','SUP-003','01-08-2019','01-09-2019','Формирование команды','Выполнена','Ильин','Александр','Support Engineer','Support Department','Гапанович','Евгений');

-- PROJECT --

INSERT INTO PROJECT
  (NAME, DESCRIPTION, START_DATE, FINISH_DATE)
SELECT DISTINCT
  Project_Name, Project_Description, Project_Start_Date, Project_End_Date
FROM DATA_TABLE;

-- STAGE --

INSERT INTO STAGE
  (NAME, START_DATE, FINISH_DATE, PROJECT_ID)
SELECT DISTINCT
  Stage_Name, Stage_Start_Date, Stage_End_Date, P.ID
FROM DATA_TABLE
  LEFT JOIN PROJECT P ON (Project_Name = P.NAME AND Project_Description = P.DESCRIPTION AND Project_Start_Date = P.START_DATE AND Project_End_Date = P.FINISH_DATE);
  
-- TASK STATUS --

INSERT INTO TASK_STATUS (NAME) 
SELECT DISTINCT Stage_Tasks_Status 
FROM DATA_TABLE;

-- TASK --

INSERT INTO TASK
  (CODE, NAME, START_DATE, FINISH_DATE, STAGE_ID, TASK_STATUS_ID)
SELECT DISTINCT
  Stage_Tasks_Code, Stage_Tasks_Name, Stage_Tasks_Start_Date, Stage_Tasks_End_Date, S.ID, TS.ID
FROM DATA_TABLE
  LEFT JOIN PROJECT P ON (Project_Name = P.NAME AND Project_Description = P.DESCRIPTION AND Project_Start_Date = P.START_DATE AND Project_End_Date = P.FINISH_DATE)
  LEFT JOIN STAGE S ON (Stage_Name = S.NAME AND Stage_Start_Date = S.START_DATE AND Stage_End_Date = S.FINISH_DATE AND P.ID = S.PROJECT_ID)
  LEFT JOIN TASK_STATUS TS ON (Stage_Tasks_Status = TS.NAME);

-- DEPARTMENT --

INSERT INTO DEPARTMENT
  (NAME)
SELECT DISTINCT
  Assigned_Person_Department
FROM DATA_TABLE;

-- DEVELOPER --

INSERT INTO DEVELOPER
  (FIRST_NAME, LAST_NAME, DEPARTMENT_ID)
SELECT DISTINCT
  Assigned_Person_Name, Assigned_Person_Last_Name, D.ID
FROM DATA_TABLE
  LEFT JOIN DEPARTMENT D ON (Assigned_Person_Department = D.NAME);

-- DEVELOPER TASK --

INSERT INTO DEVELOPER_TASK
  (DEVELOPER_ID, TASK_ID)
SELECT DISTINCT
  DEV.ID, T.ID
FROM DATA_TABLE
  LEFT JOIN DEPARTMENT DEP ON (Assigned_Person_Department = DEP.NAME)
  LEFT JOIN DEVELOPER DEV ON (Assigned_Person_Name = DEV.FIRST_NAME AND Assigned_Person_Last_Name = DEV.LAST_NAME AND DEP.ID = DEV.DEPARTMENT_ID)
  LEFT JOIN PROJECT P ON (Project_Name = P.NAME AND Project_Description = P.DESCRIPTION AND Project_Start_Date = P.START_DATE AND Project_End_Date = P.FINISH_DATE)
  LEFT JOIN STAGE S ON (Stage_Name = S.NAME AND Stage_Start_Date = S.START_DATE AND Stage_End_Date = S.FINISH_DATE AND P.ID = S.PROJECT_ID)
  LEFT JOIN TASK_STATUS TS ON (Stage_Tasks_Status = TS.NAME)
  LEFT JOIN TASK T ON (Stage_Tasks_Code = T.CODE AND Stage_Tasks_Name = T.NAME AND Stage_Tasks_Start_Date = T.START_DATE AND Stage_Tasks_End_Date = T.FINISH_DATE AND S.ID = T.STAGE_ID AND TS.ID = T.TASK_STATUS_ID);

-- ROLE --

INSERT INTO ROLE
  (NAME)
SELECT DISTINCT
  Assigned_Person_Position
FROM DATA_TABLE;

-- PROJECT DEVELOPER ROLE --

INSERT INTO PROJECT_DEVELOPER_ROLE
  (PROJECT_ID, DEVELOPER_ID, ROLE_ID)
SELECT DISTINCT
  P.ID, DEV.ID, R.ID
FROM DATA_TABLE
  LEFT JOIN PROJECT P ON (Project_Name = P.NAME AND Project_Description = P.DESCRIPTION AND Project_Start_Date = P.START_DATE AND Project_End_Date = P.FINISH_DATE)
  LEFT JOIN DEPARTMENT DEP ON (Assigned_Person_Department = DEP.NAME)
  LEFT JOIN DEVELOPER DEV ON (Assigned_Person_Name = DEV.FIRST_NAME AND Assigned_Person_Last_Name = DEV.LAST_NAME AND DEP.ID = DEV.DEPARTMENT_ID)
  LEFT JOIN ROLE R ON (Assigned_Person_Position = R.NAME);

-- TEAM --

INSERT INTO TEAM
  (NAME, LEAD_ID)
SELECT DISTINCT
  Team_Lead_Name || ' ' || Team_Lead_Last_Name, DEV.ID
FROM DATA_TABLE
  LEFT JOIN DEPARTMENT DEP ON (Assigned_Person_Department = DEP.NAME)
  LEFT JOIN DEVELOPER DEV ON (Team_Lead_Name = DEV.FIRST_NAME AND Team_Lead_Last_Name = DEV.LAST_NAME AND DEP.ID = DEV.DEPARTMENT_ID)
WHERE
  Team_Lead_Name IS NOT NULL OR Team_Lead_Last_Name IS NOT NULL;

-- TEAM DEVELOPER --

INSERT INTO TEAM_DEVELOPER
  (TEAM_ID, DEVELOPER_ID)
SELECT DISTINCT
  T.ID, DEV.ID
FROM DATA_TABLE
  LEFT JOIN TEAM T ON (Team_Lead_Name || ' ' || Team_Lead_Last_Name = T.NAME)
  LEFT JOIN DEPARTMENT DEP ON (Assigned_Person_Department = DEP.NAME)
  LEFT JOIN DEVELOPER DEV ON (Assigned_Person_Name = DEV.FIRST_NAME AND Assigned_Person_Last_Name = DEV.LAST_NAME AND DEP.ID = DEV.DEPARTMENT_ID)
WHERE
  Team_Lead_Name IS NOT NULL OR Team_Lead_Last_Name IS NOT NULL;

-- TEAM PROJECT --

INSERT INTO TEAM_PROJECT
  (TEAM_ID, PROJECT_ID)
SELECT DISTINCT
  T.ID, P.ID
FROM DATA_TABLE
  LEFT JOIN TEAM T ON (Team_Lead_Name || ' ' || Team_Lead_Last_Name = T.NAME)
  LEFT JOIN PROJECT P ON (Project_Name = P.NAME AND Project_Description = P.DESCRIPTION AND Project_Start_Date = P.START_DATE AND Project_End_Date = P.FINISH_DATE)
WHERE
  Team_Lead_Name IS NOT NULL OR Team_Lead_Last_Name IS NOT NULL;

COMMIT;
